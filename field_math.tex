\chapter*{\ref{part:math}部の流れ}
\ref{part:math}部は数学を中心とした内容です。

\ref{chap:finite_math}章では有限体での割り算のやり方を詳しく紹介します。
それからペアリングの計算で現れる拡大体の紹介もします。
多項式を使って拡大体を作る方法は、\ref{rlwe}節で紹介したring-LWEベースの準同型暗号の構成にも使われる重要なものです。

\ref{chap:ec_math}章ではトーラスと楕円曲線の関係を紹介します。
$\wp$関数と呼ばれる複素数上の二重周期関数を用いてトーラスからWeierstrassの方程式の解（楕円曲線）への写像を構成します。
それからトーラスの上で自然に考えられた足し算が楕円曲線上ではどのような演算になるのか、幾何学的な定義と具体的な式を導出します。
群の単位元になる無限遠点は射影空間を導入すると統一的に扱えます。

最後に演算を効率的に行うための手法をいくつか紹介します。
楕円曲線暗号を実際にコンピュータで計算させるのに必要な知識です。

\ref{chap:pairing_math}章ではペアリングの定義と具体的な計算方法について述べます。
そのために楕円曲線上の点からなる因子と呼ばれるものを定義し、因子と楕円曲線上の関数の密接な関係を紹介します。

\chapter{有限体}
\label{chap:finite_math}
\ref{part:new}部で紹介した暗号プロトコルは有限体や楕円曲線、ペアリングなどの数学的対象物が登場しました。
楕円曲線は浮輪の表面（トーラス）という幾何学的な描写で紹介し、ペアリングも同じ枠組みで説明しました。
それはできるだけ少ない数学的知識でイメージしやすいものにしたかったからです。

基本的な性質を認めれば、それらを利用した暗号プロトコルの理解はできると思います。
しかし、楕円曲線やペアリングを使った暗号をコンピュータ上で実装しようとするとそれだけでは不十分です。
これ以降の章では数学的な準備を追加しつつ、有限体の補足や楕円曲線の代数的な側面、およびペアリングの具体的な計算方法について触れたいと思います。

\section{Euclidの互除法と有限体の逆数}
\label{calc_field_inv}
有限体の逆数は\ref{field_inv}節で定義しましたが素数$p$に対して$\FF_p$が体になることは示していませんでした。
この節では$\FF_p$が体になること、すなわち$0$でない任意の元$x \in \FF_p$に対して逆数が存在することを具体的に計算して示します。

そのための準備としてまず任意の自然数$a$, $b$の最大公約数（greatest common divisor）$\gcd(a,b)$の求め方を説明します。
たとえば72と27の最小公倍数は$72=2^3 \cdot 3^2$, $27=3^3$ですから$\gcd(72,27)=3^2=9$です。

因数分解しないで求める方法として次の方法があります。
もしかしたら小学校で習った方がいらっしゃるかもしれません。
\begin{align*}
& 72 / 27 = 2 余り 18.\\
& 27 / 18 = 1 余り 9.\\
& 18 / 9 = 2.
\end{align*}
$18/9=2$で割り切れたので$\gcd(72,27)=9$です。
これを一般化します。

まず最大公約数の性質を確認しましょう。
\begin{enumerate}
\item 0はどんな数の倍数でもあるので$\gcd(a,0)=a$。
\item $\gcd(a,b)=\gcd(a-b,b)$。

等号を確認するために$c:=\gcd(a,b), c':=\gcd(a-b,b)$とおきます。
$a=ca'$, $b=cb'$と書けるので$a-b=c(a'-b')$。
よって$c$は$a-b$と$b$の公約数となり、$c'$の最大性から$c \le c'$。
同様に$a-b=c'x$, $b=c'y$と書くと$a=c'(x+y)$。
よって$c'$は$a$と$b$の公約数となり、$c$の最大性から$c' \le c$。
よって$c=c'$。\qed
\item $b \ne 0$のとき$\gcd(a,b)=\gcd(a \bmod{b},b)$。

二つ目の性質を繰り返し適用すればOKです。
\end{enumerate}

これらの性質を踏まえて$r_0 > r_1 \ge 0$となる整数の$c:=\gcd(r_0,r_1)$を求めます。
$r_1=0$なら$c=r_0$です。
$r_1>0$なら$r_0$を$r_1$で割って$r_0=r_1 q_2 + r_2$, $0 \le r_2 < r_1$とします。
\[
\gcd(r_0,r_1)=\gcd(r_0 \bmod{r_1}, r_1)=\gcd(r_2,r_1).
\]
$r_2=0$なら$\gcd(r_0,r_1)=r_1$です。
$r_2>0$なら今度は$r_1$を$r_2$で割ります。
$r_1=r_2 q_3 + r_3$, $0 \le r_3 < r_2$とおくと
\[
\gcd(r_0,r_1)=\gcd(r_1,r_2)=\gcd(r_2,r_3).
\]
これを繰り返し適用すると$r_0 > r_1 > r_2 > \dots$という自然数の減少列ができます。
$r_i \ge 0$なのでこれは有限回で止まります。
つまり$r_s=0$となる$s$があり、$\gcd(r_0,r_1)=r_{s-1}$となります。
これをEuclidの互除法といいます。

先ほどの例を見直すと、
\begin{align*}
\gcd(72,27)&=\gcd(72\bmod{27},27)=\gcd(18,27)=\gcd(27,18)\\
&=\gcd(27\bmod{18},18)=\gcd(9,18)=\gcd(18,9)=\gcd(18\bmod{9},9)\\
&=\gcd(0,9)=9
\end{align*}
を計算していたのでした。
\image{gcd.pdf}{72と27の最大公約数の求め方}
横72、縦27の長方形を大きな正方形から敷きつめていく感じです。

さて、たとえば$s=5$だったとすると、
\begin{align*}
 r_0 &= r_1 q_2 + r_2,\\
 r_1 &= r_2 q_3 + r_3,\\
 r_2 &= r_3 q_4 + r_4,\\
 r_3 &= r_4 q_5 + r_5(=0)
\end{align*}
という関係式が成立しています。
すると
\begin{align*}
\gcd(r_0,r_1)&=r_4=r_2 - r_3 q_4 = r_2 - (r_1 - r_2 q_3)q_4 = r_1(-q_4) + r_2(1 + q_3 q_4)\\
   &=r_1(-q_4)+(r_0-r_1 q_2)(1 + q_3 q_4)\\
   &=r_0(1+q_3 q_4) + r_1(-q_4-q_2(1+q_3 q_4)).
\end{align*}
これは$a$, $b$となる整数を用いて
\[
a r_0 + b r_1 = \gcd(r_0, r_1)
\]
とできることを示しています。
しかも$a$, $b$はこの手続きで具体的に計算できます。
同様の手順をたどることで一般の$s$に対しても整数$a$, $b$を具体的に計算し
\[
a r_0 + b r_1 = \gcd(r_0, r_1)
\]
とできます。
この方法を拡張Euclidの互除法といいます。

さてようやく有限体の逆数を求める方法の準備が整いました。
任意の$x \in {\FF_p}^*:=\FF_p \setminus \Set{0}$に対して逆数を求めます。
$p$は素数で$0 < x < p-1$なので$x$と$p$は互いに素です。
つまり$\gcd(x,p)=1$です。
拡張Euclidの互除法を用いることで
\[
ax + bp = \gcd(x,p)=1
\]
となる整数$a$, $b$を見つけることができます。
このとき$ax \equiv 1 \pmod{p}$なので$a$は$x$の逆数です。
これにより$\FF_p$が有限体になることがわかりました。

\section{Euclidの互除法の効率}
前節で拡張Euclidの互除法を用いて$x \in {\FF_p}^*$の逆元を具体的に求めることができました。
この計算効率はどの程度なのでしょう。
\ref{field_inv}節で試した一つずつ逆数か確認する総当たり方法より効率はよいのでしょうか。
大雑把ですが考えてみましょう。

拡張Euclidの互除法では整数の減少列
\[
r_0 > r_1 > r_2 > \dots > r_s = 0
\]
を作ります。
$r_i$がどれぐらいの速さで小さくなるかを見積もりましょう。
$r_{i+1}$が$r_i/2$より大きいかそうでないかで場合分けします。
\mydescription{
\item[$r_{i+1} \ge r_i/2$のとき]$r_i > r_{i+1} \ge r_i/2$なので$r_i$を$r_{i+1}$で割ると商は$q_{i+2}=1$で余りは
\[
r_{i+2}=r_i-r_{i+1} \le r_i/2.
\]
\item[$r_{i+1} < r_i/2$のとき]$r_{i+2} < r_{i+1} < r_i/2$。
}
いずれの場合も$r_{i+2} \le r_i/2$です。
つまり2ステップ進めると必ず半分未満になることがわかりました。
したがって$r_s=0$となる$s$は高々$2\log_2(r_0)$となります。
$x < p$ですので逆元を求める計算は$O(\log(p))$となります。
よって総当たりよりもずっと効率がよいアルゴリズムであるとわかりました。

\section{Fermatの小定理と有限体の逆数}
\label{fermat_inv}
有限体の逆数を求める別の方法を紹介しましょう。

二項定理から始めます。
変数$x$, $y$と0以上の整数$n$に対して
\[
(x+y)^n = \sum_{k=0}^n \combi{n}{k} \, x^k y^{n-k}
\]
が成立します。
ここで
\[
\combi{n}{k}:=\frac{n!}{k! (n-k)!}
\]
は$n$個の中から$k$個取り出す組み合わせの数で二項係数といいます。
二項定理を証明しましょう。

$n=0$のときは両辺ともに1で成立します（$x^0=0$とします）。

$n=k$のとき成立すると仮定すると$n=k+1$のとき、
\begin{align*}
(x+y)^{n+1} &= (x+y)(x+y)^n=(x+y)\left(\sum_{k=0}^n \combi{n}{k} \, x^k y^{n-k}\right)\\
 &= \left(\sum_{k=0}^n \combi{n}{k} \, x^{k+1} y^{n-k}\right) + \left(\sum_{k=0}^n \combi{n}{k} \, x^k y^{n+1-k}\right)\\
 &\text{（一つ目の項で$k=n$を分ける。二つ目の項で$k=0$を分ける）}\\
 &= x^{n+1}+\left(\sum_{k=0}^{n-1} \combi{n}{k} \, x^{k+1} y^{n-k}\right) + \left(\sum_{k=1}^n \combi{n}{k} \, x^k y^{n+1-k}\right) + y^{n+1}\\
 &= x^{n+1}+\left(\sum_{k=1}^{n} \combi{n}{k-1} \, x^{k} y^{n+1-k}\right) + \left(\sum_{k=1}^n \combi{n}{k} \, x^k y^{n+1-k}\right) + y^{n+1}\\
 &= x^{n+1}+\left(\sum_{k=1}^{n} (\combi{n}{k-1}+\combi{n}{k}) x^{k} y^{n+1-k}\right) + y^{n+1}.
\end{align*}
ここで
\begin{align*}
\combi{n}{k-1}+\combi{n}{k} &= \frac{n!}{(k-1)!(n-k+1)!} + \frac{n!}{k! (n-k)!}\\
&=\frac{n! k}{k! (n+1-k)!}+\frac{n!(n+1-k)}{k! (n+1-k)!}\\
&=\frac{n! (k+n+1-k)}{k! (n+1-k)!}=\frac{(n+1)!}{k!(n+1-k)!}=\combi{n+1}{k}
\end{align*}
を使うと
\begin{align*}
(x+y)^{n+1}= x^{n+1}+\left(\sum_{k=1}^{n} \combi{n+1}{k} \, x^{k} y^{n+1-k}\right) + y^{n+1}= \sum_{k=0}^{n+1} \combi{n+1}{k} \, x^k y^{n+1-k}
\end{align*}
が成立します。よって任意の$n$について二項定理が成立します。\qed

文末の$\Box$は証明の終わりを示す記号です。
二項係数を図\ref{fig:combi.pdf}のように三角形に並べると、ある列の隣り合う2個の数字の和が一つ下の列の値になっていることがわかります。
これは上で示した$\combi{n}{k-1}+\combi{n}{k}=\combi{n+1}{k}$の関係を示しています。
たとえば$n=6$, $k=5$のとき、
\[
\combi{6}{5-1}+\combi{6}{5}=15+6=21=\combi{7}{5}
\]
です。
この形をPascal（パスカル）の三角形といいます。
またこの関係式や図から任意の$\combi{n}{k}$が自然数であることを見てとれます。
\image{combi.pdf}{Pascalの三角形}
\begin{lemma}
\label{combi_zero}
素数$p$と$0 < k < p$となる自然数$k$に対して$\combi{p}{k}$は$p$の倍数である。
\end{lemma}
なぜなら$\combi{p}{k}=\frac{p!}{k!(p-k)!}$の分子$p!$は$p$の倍数で、分母$k!(p-k)!$に$p$は出てこないので$p$が約分されないからです。\qed

図\ref{fig:combi.pdf}では$n=2, 3, 5, 7$のとき両側の1以外は$n$の倍数であることを確認できます。
$n$が4や6などの合成数のときは$n$の倍数になっていないですね。
\begin{lemma}
\label{frobenius}
素数$p$と整数$x$, $y$に対して
\[
(x+y)^p \equiv x^p + y^p \pmod{p}.
\]
\end{lemma}
なぜなら左辺を二項展開すると補題\ref{combi_zero}より$k$が0や$p$以外では係数が$p$の倍数となるからです。\qed
\begin{lemma}
\label{p_power_is_id}
素数$p$と整数$x$に対して
\[
x^p \equiv x \pmod{p}.
\]
\end{lemma}
なぜなら補題\ref{frobenius}を使うと
\begin{align*}
x^p&=(1+(x-1))^p \equiv 1^p+(x-1)^p=1+(x-1)^p\equiv 1+1+(x-2)^p\\
& \equiv \dots \equiv \underbrace{1 + \cdots + 1}_{x個}=x \pmod{p}.
\end{align*}
\qed
\begin{theorem}[Fermat（フェルマー）の小定理]
有限体${\FF_p}^*$の元$x$に対して
\[
x^{p-1} = 1.
\]
\end{theorem}
なぜなら補題\ref{p_power_is_id}の右辺を左辺に移項して$x(x^{p-1}-1) \equiv 0 \pmod{p}$.
$0 < x < p$なら$x$は$p$と互いに素なので$x^{p-1}-1 \equiv 0 \pmod{p}$。
つまり有限体の元として$x^{p-1}-1=0$。\qed

Fermatの小定理を示せたので有限体の逆数の求め方の準備が整いました。
有限体${\FF_p}^*$の元$x$に対して、
\[
x^{p-1}=x \cdot x^{p-2} = 1
\]
が成立します。
これは$x^{p-2}$が$x$の逆数であることを示しています。
また、巾乗の計算は\ref{binary-method}節で示したように$O(\log(p))$で計算できます。
よってこの方法は拡張Euclidの互除法と同程度の計算量でできることがわかりました。

\section{巡回群の位数}
\label{fp_size}
\ref{cyclic}節で確認したように${\FF_7}^*:=\FF_7 \setminus \Set{0}$の要素からなる乗法的巡回群について、その位数は1, 2, 3, 6の4種類ありました。
これは${\FF_7}^*$の位数$7-1=6$の約数です。
一般に${\FF_p}^*$の要素$g$に対して巡回群$\gen{g}$の位数は$p-1$の約数になります。

なぜなら
$g$の位数を$a$とします。
定義により$a$は$g^a=1$となる最小の$a$で$a \le p-1$です。
またFermatの小定理より$g^{p-1}=1$です。
$a$と$p-1$について拡張Euclidの互除法により
\[
as + t(p-1)=\gcd(a,p-1)
\]
となる整数$s$, $t$があります。
すると
\[
g^{\gcd(a,p-1)}=g^{as+t(p-1)}=(g^a)^s \cdot (g^{p-1})^a=1.
\]
$\gcd(a,p-1)\le a$で$a$の最小性より$\gcd(a,p-1)=a$。
つまり$a$は$p-1$の約数です。\qed

\section{拡大体}
\label{extend_field}
実数に対する複素数のように有限体$\FF_p$の複素数版、あるいはそれの一般化である拡大体を紹介します。\index{たい@体}
拡大体とはいくつかの$\FF_p$をまとめたものに新しい四則演算を定義して一つの体と見なしたものです。
拡大体はペアリングの計算で必要になります。

定義に入る前に、まずは複素数の作り方を確認しましょう。
複素数$\CC$の点$z$は実数$\RR$の2点$a$, $b$を使って
\[
z=a+bi
\]
と表しました。
ここで$i$は2乗して$-1$になる値です。
2点$z_1=a+bi$, $z_2=c+di$に対して加減算は
\[
z_1 \pm z_2:=(a \pm c) + (b \pm d)i
\]
です。乗算は$i^2=-1$という規則により
\[
z_1 z_2:=(a c - b d) + (a d + b c)i
\]
となります。$z=x+yi$の逆数は分子、分母に$x-yi$を掛けることで
\[
\frac{1}{z}=\frac{1}{a+bi}=\frac{a-bi}{(a+bi)(a-bi)}=\frac{a-bi}{a^2+b^2}=\frac{a}{a^2+b^2}-\frac{b}{a^2+b^2}i
\]
とできました。

2乗して$-1$になる値は$\RR$の中には存在しません。
しかしその値を形式的に$i$とおいて$r_0+bi$に対して$i$が変数であるかのように計算し、
$i^2$がでてきたら$-1$に置き換えるという作業をしています。
この作業により$\CC$は体になりました。このとき$\CC$は$\RR$の2次拡大体であるといいます。
$\CC$は2次元$\RR$ベクトル空間に掛け算と割り算を導入したものと考えることもできます。

今$\RR$に対してこの作業をしましたが、これを$\FF_7$に置き換えて考えてみましょう。
すると実数に対する複素数と同様に計算できることがわかります。
係数はそれぞれ$\bmod{7}$します。

たとえば$(3+2i)+(6+5i)=9+7i=2$とか$(3+2i)(6+5i)=(18-10)+(15+16)i=8+31i=1+3i$ということです。

このように$\FF_7$に$i$を追加してできた$r_0+bi$の形の集合を$\FF_{7^2}$と書いて$\FF_7$の2次拡大体といいます。
$7^2=49$で$\ZZ/49\ZZ$と間違えそうですが、全然違うものであることに注意してください。
$\ZZ/p\ZZ$は$p$が素数のときでないと逆数が存在しないことがあり体にならないのでした（\ref{field_inv}節参照）。

$\FF_p$に$i$を追加する操作はいつでもうまくいくのでしょうか。実はそうではないのです。
たとえば$\FF_5$に$i$を追加してもうまくいきません。なぜならたとえば
\[
(1+2i)(1-2i)=(1+4)+(2-2)i=5 = 0 \bmod{5}
\]
という等式が成立します。
これは0でない2個の数を掛けて0になることを示しています。
つまり$1+2i$の逆数は存在しないため$\FF_5[i]$は体ではありません。

実数$\RR$や$\FF_7$に$i=\sqrt{-1}$を追加してうまく拡大体を作れたのは、
その値が$\RR$や$\FF_7$に含まれていなかったからなのでした。
つまり方程式$t^2=-1$の解が$\RR$や$\FF_7$に解を持たないということです。
実際、$\FF_7$の中で$0, 1, 2, \ldots, 6$を2乗すると$0, 1, 4, 2, 2, 4, 1$となり$-1=6\bmod{7}$になるものはありません。

$\FF_5$ではどうでしょう。
$2^2=4=-1 \bmod 5$なので$\FF_5$の中で$t^2=-1$は解を持ちます。
つまり$t^2+1=(t+2)(t-2)$と因数分解できるということです。
方程式$t^2+1=0$の解が$\FF_p$の中で解けると$\FF_p$に$i=\sqrt{-1}$を追加しても拡大体はできません。
解けない場合は拡大体を作れることがわかります。
方程式が解けないとき、つまり因数分解できないとき$t^2+1$を$\FF_p$上既約であるといいます。

まとめると$f(t)=t^2+1$について$i$を$f(i)=0$となる形式的な値として
\begin{itemize}
\item[] $f(t)=(t+2)(t-2) \bmod{5}$なので$\FF_5$に$i$を追加しても拡大体にならない
\item[] $f(t)$は$\FF_7$上既約なので$\FF_7$に$i$を追加すると2次拡大体$\FF_{7^2}$になる
\end{itemize}
ということです。

ところで「形式的な値を追加する」というのがやや気持ち悪いですね。
そこで、もう少し別の表現をしてみます。
今$t$を変数とする多項式で、その係数が$K$（$K$は$\CC$や$\FF_p$など）であるもの全体を$K[t]$と書くことにします。
\[
K[t] := \Set{f(t):=\sum_j^n a_j t^j|a_j \in K, n = 0, 1, 2, \dots}.
\]
この多項式を$t^2+1$で割った余り全体の集合を$R:=K[t]/(t^2+1)$と書くことにします。
2次の多項式で割っているので余りは1次式の集まりです。
つまり
\[
R:=K[t]/(t^2+1)=\Set{a+bt|a, b \in K}
\]
となります。
$R$の2個の元$a+bt$, $c+dt$に対して足し算や引き算は
\[
(a+bt)\pm (c+dt):=(a\pm c)+(b \pm d)t
\]
です。
掛け算をすると2次の項が出ますが$t^2+1$で割った余りを考えているので
\begin{align*}
(a+bt)(c+dt) &:= ac+(ad+bc)t+bdt^2\\
    &= ac+(ad+bc)t+bd(t^2+1-1)\\
    &= (ac-bd)+(ad+bc)t \pmod{t^2+1}
\end{align*}
となります。これらの計算は複素数の計算で$i$を$t$に置き換えたものと同じ形をしています。
つまり複素数全体は実数係数の多項式全体を$t^2+1$で割った余り$\RR[t]/(t^2+1)$とみなせます。
これにより「形式的な値$i$を追加する」という操作を厳密に表現できます。

一般的には$t$に関する$\FF_p$係数の$n$次多項式$f(t)$が既約なとき、$\FF_p[t]/(f(t))$は係数が$\FF_p$で高々$n-1$次の多項式
の集まりであり、この中で四則演算を定義できます。
この集合を$\FF_{p^n}$と書いて$\FF_p$の$n$次拡大体といいます。拡大する前の$\FF_p$を\ruby{素体}{そ|たい}ということがあります。
\[
\FF_{p^n}:=\FF_p[t]/(f(t)):=\Set{\sum_{j=0}^{n-1} a_j t^j|a_j \in \FF_p}.
\]
拡大体$\FF_{p^n}$の標数は基礎体$\FF_p$の標数と同じ$p$と定義されます。
次数が異なる二つの既約多項式$f_1$, $f_2$から作った拡大体$\FF_p[t]/(f_1(t))$と$\FF_p[t]/(f_2(t))$は同じ形になることが示されます。
ただ「同じ形であること」の詳細は準備がいろいろ必要なので、ここでは省略します。
\section{代数的閉包}
\label{alg_closure}
拡大体を作る操作は繰り返せます。
前節では$\FF_7$上の既約多項式$f(t)=t^2+1$を追加して$\FF_{7^2}$を作りました。
今度はこの拡大体を作ってみます。

$\FF_{7^2}$の全ての元$x=a+bi$（$i^2=-1$）の2乗の値を調べると、たとえば$1+2i$になる元がないことに気づきます。
つまり$g(s):=s^2-(1+2i)$は$\FF_{7^2}$上既約な多項式です。
よって$\FF_{7^2}/(g(s))$は$\FF_{7^2}$の2次拡大体$\FF_{7^4}$になります。

体$k$に対してこの操作を（一般には無限回）繰り返し、もうそれ以上拡大体を作れないようになった体を$k$の\ruby{代数的閉包}{だい|すう|てき|へい|ほう}といい$\overline{k}$と書きます。
\[
\FF_p \subseteq \FF_{p^2} \subseteq \FF_{p^4} \subseteq \dots \subseteq \overline{\FF_p}.
\]
実数体$\RR$に対しては$\sqrt{-1}$を追加して作った複素数体$\CC$が$\RR$の代数的閉包$\overline{\RR}$になっています。
拡大の操作は1回だけでよいのです。
これは複素数係数のどんな多項式も1次式の積に因数分解できることを表しています。
これを代数学の基本定理といいます。

\section{拡大体の元の逆元}
前節で素数$p$に対して$\FF_p$の$n$次拡大体$\FF_{p^n}$を既約多項式$f(x)$を用いて定義しました。
拡大体$\FF_{p^n}$の0以外の元$a=a(t)$（$a(t)$は高々$n-1$次の多項式）の逆元の求め方を紹介します。
これは\ref{calc_field_inv}節で紹介したEuclidの互除法と同様のやり方が使えます。
\ref{calc_field_inv}節の$r_0$, $r_1$の最大公約数を求める手続きを$r_0:=f(t)$, $r_1:=a(t)$としてまねをします。
\[
r_0 :=r_1 q_2 + r_2.
\]
ここで$q_2$と$r_2$は$t$に関する多項式で$r_2$は$\deg a(t)$より小さい次数です。
割り算を繰り返すと、次数に関する
\[
\deg r_0 > \deg r_1 > \deg r_2 > \dots \ge 0
\]
という自然数の減少列ができます。
この操作はいつか有限回で止まります。つまり$\deg r_s = 0$となるある$s$があり、
\[
\gcd(r_0,r_1)=r_s
\]
となります。$r_s$は定数であり、$f(t)$の既約性から0ではありません。
適当に定数倍することで
ある多項式$u(t)$, $v(t)$で
\[
a(t)u(t)+f(t)v(t)=1
\]
となるものが見つかったことになります。
すると
\[
a(t)u(t) \equiv 1 \pmod{f(t)}
\]
となり、$\FF_{p^n}$の中で$u(t)$が$a(t)$の逆元です。

\section{この章のまとめ}
有限体上の逆元計算に必要なEuclidの互除法やFermatの小定理を紹介しました。
また有限体と既約多項式を組み合わせることで、その有限体を含む拡大体を構成できます。
拡大体の元の逆元も素体の元の逆元と同様、多項式に関するEuclidの互除法を利用することで求められます。
